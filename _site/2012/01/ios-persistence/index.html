<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="dfas" />
    <title>iOS持久化 | dfas</title>
    <link href="data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAD/APr59wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIiIiIiIiAAAiIiIiIiIAACIiIiIiIgERERERERIiAREREREREiIBERERERESIgERIiIiERIiAREiIiIREiIBESIhERESIgERIiERERIiAREiIiIiIiIBESIiIiIiIgERIiIiIiIiAREREREREAABEREREREQAAERERERERAADgAQAA4AEAAOABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAA8AAAAPAAAADwAA" rel="icon" type="image/x-icon" />
    <link href="/feed/" rel="alternate" title="dfas" type="application/atom+xml" />

    <link rel="stylesheet" href="/media/css/highlight.css">
    <link href='/media/webfonts/ss-social.css' rel='stylesheet'>
    <link href='/media/webfonts/ss-standard.css' rel='stylesheet'>
    <link href="/media/css/screen.css" rel="stylesheet">

    <script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script>

    <script type="text/javascript"
       src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Config({
 jax: ["input/TeX","output/HTML-CSS"],
 displayAlign: "left"
});
</script>
  </head>
  <body>
    <div id="container">
      <div id="main" role="main">
        <header>
        <div class="buttons">
          <a href="/" class="ss-icon" title="Go to homepage">home</a>
          <a href="/categories" class="ss-icon" title="Category" >list</a>
          <a href="/tags" class="ss-icon" title="Tag Cloud" >tags</a>
          <a href="/guestbook" class="ss-icon" title="Guest Book" >talk</a>
          <a href="/about" class="ss-icon" title="About" >user</a>
          <a href="/feed" class="ss-icon" title="Subscribe by RSS" >rss</a>
        </div>
        <h1>iOS持久化</h1>
        </header>
        <hr>
        <article class="content">
        <section class="post">
<ul>
  <li>文件系统</li>
  <li>归档和序列化</li>
  <li>数据库</li>
</ul>

<hr />

<p>##1.文件系统
不管是Mac OS X 还是iOS的文件系统都是建立在UNIX文件系统基础之上的。</p>

<p>###1.1 沙盒模型 <br />
在iOS中，一个App的读写权限只局限于自己的沙盒目录中。</p>

<blockquote>
  <p><strong>沙盒模型到底有哪些好处呢?</strong><br />
安全：别的App无法修改你的程序或数据<br />
保护隐私：别的App无法读取你的程序和数据<br />
方便删除：因为一个App所有产生的内容都在自己的沙盒中，所以删除App只需要将沙盒删除就可以彻底删除程序了</p>
</blockquote>

<p>iOS App沙盒中的目录</p>

<ul>
  <li>App Bundle ,如xxx.app 其实是一个目录，里面有app本身的二进制数据以及资源文件</li>
  <li>Documents, 存放程序产生的文档数据</li>
  <li>Library , 下面默认包含下面两个目录 Caches Preferences</li>
  <li>tmp, 临时文件目录</li>
</ul>

<p>如果我们想在程序中获取上面某个目录的路径，应该如何实现呢？
下面就讲讲路径的获取，
通过<code class="highlighter-rouge">NSPathUtilities.h </code>中的<code class="highlighter-rouge">NSSearchPathForDirectoriesInDomains</code>函数，我们便可以获取我们想要的路径。
此函数具体声明如下:</p>

<blockquote>
  <p>NSArray *NSSearchPathForDirectoriesInDomains(NSSearchPathDirectory directory, NSSearchPathDomainMask domainMask, BOOL expandTilde); <br />
<strong>directory</strong> 目录类型 比如Documents目录 就是NSDocumentDirectory <br />
<strong>domainMask</strong> 在iOS的程序中这个取NSUserDomainMask <br />
<strong>expandTilde</strong> YES，表示将~展开成完整路径</p>
</blockquote>

<p>注意函数返回的类型为数组，在iOS中一般这个数组中只包含一个元素，所以直接取lastObject即可。</p>

<p>###1.2 NSFileManager
NSFileManager提供一个类方法获得一个单例。</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="cm">/* Returns the default singleton instance.*/</span>
<span class="k">+</span> <span class="p">(</span><span class="n">NSFileManager</span> <span class="o">*</span><span class="p">)</span><span class="n">defaultManager</span><span class="p">;</span></code></pre></figure>

<p>下面罗列了NSFileManager的常用方法</p>

<ul>
  <li>新建目录</li>
</ul>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">createDirectoryAtPath</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">withIntermediateDirectories</span><span class="p">:(</span><span class="n">BOOL</span><span class="p">)</span><span class="nv">createIntermediates</span> <span class="nf">attributes</span><span class="p">:(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">attributes</span> <span class="nf">error</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span></code></pre></figure>

<p>createIntermediates这个参数一般为YES，表示如果目录路径中间的某个目录不存在则创建之,如果是NO的话，则要保证所创建目录的父目录都必须已经存在</p>

<ul>
  <li>获取目录下的所有文件</li>
</ul>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="k">-</span> <span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nf">contentsOfDirectoryAtPath</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">error</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span></code></pre></figure>

<p>如果目录为空，则返回空数组</p>

<ul>
  <li>其他的一些方法</li>
</ul>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">copyItemAtPath</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">srcPath</span> <span class="nf">toPath</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">dstPath</span> <span class="nf">error</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">moveItemAtPath</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">srcPath</span> <span class="nf">toPath</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">dstPath</span> <span class="nf">error</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">linkItemAtPath</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">srcPath</span> <span class="nf">toPath</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">dstPath</span> <span class="nf">error</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">removeItemAtPath</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">error</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span></code></pre></figure>

<p>更多的可以查看文档 <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/Reference/Reference.html">NSFileManager Class Reference</a>。</p>

<p>在实际项目中，我们一般会写一个工具类来负责项目中所有的路径操作。</p>

<p>##2. 归档（Archives） 和 序列化（Serializations）
我们经常听到“序列化”，“反序列化”这样的字眼，其实“序列化”的意思就是将对象转换成字节流以便保存或传输，“反序列化”便是一个相反的过程，从字节流转到对象。</p>

<p>在这节中涉及到一种文件类型plist，plist就是Property List 的缩写,即所谓的属性列表，属性列表有两种数据格式，一种是XML的，方便阅读和编辑；另一种是二进制的，节省存储空间，以及提高效率。</p>

<p>在Objective-C中这个对象和字节流的互转分成两类:</p>

<ul>
  <li><strong>归档</strong> 普通自定义对象和字节流之间的转换</li>
  <li><strong>序列化</strong> 某些特定类型（NSDictionary, NSArray, NSString, NSDate, NSNumber，NSData）的数据和字节流之间(通常将其保存为plist文件)的转换</li>
</ul>

<p>不过本质上讲上述两种都是对象图(<a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/Archiving/Articles/objectgraphs.html#//apple_ref/doc/uid/20001293-CJBDFIBI">Object Graph</a>)和字节流之间的转换.
Apple关于序列化和归档的编程指南: <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/Archiving/Archiving.html">Archives and Serializations Programming Guide</a> 。</p>

<p>###2.1 归档
如果我们需要将自定义的一个对象保存到文件，应该如何做呢？ <br />
这里引入两个东西：一个是NSCoding协议 ；另一个是NSKeyedArchiver，NSKeyedArchiver其实继承于NSCoder，可以以键值对的方式将对象的属性进行序列化和反序列化。    <br />
具体的过程可以这样描述 <strong>通过NSKeyedArchiver 可以将实现了NSCoding协议的对象 和 字节流 相互转换</strong> 。</p>

<p>像一些框架中的数据类型如NSDictionary,NSArray,NSString… 都已经实现了NSCoding协议，所以可以直接对他们进行归档操作。</p>

<p>这里来一个比较完整的例子，一个Address类，一个User类，User类下有个Address类型的属性。</p>

<p><strong>Address类</strong></p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="k">@interface</span> <span class="nc">Address</span> <span class="p">:</span> <span class="nc">NSObject</span><span class="o">&lt;</span><span class="n">NSCoding</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">country</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">city</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">country</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">city</span><span class="p">;</span>
<span class="k">@end</span>
<span class="c1">//////////////////////////////////////////////////////
</span><span class="cp">#import "Address.h"
</span>
<span class="k">@implementation</span> <span class="nc">Address</span>
<span class="k">@synthesize</span> <span class="n">country</span><span class="p">;</span>
<span class="k">@synthesize</span> <span class="n">city</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">encodeWithCoder</span><span class="p">:(</span><span class="n">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">aCoder</span><span class="p">{</span>
    <span class="p">[</span><span class="n">aCoder</span> <span class="nf">encodeObject</span><span class="p">:</span><span class="n">country</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"country"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">aCoder</span> <span class="nf">encodeObject</span><span class="p">:</span><span class="n">city</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"city"</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithCoder</span><span class="p">:(</span><span class="n">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">aDecoder</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">setCountry</span><span class="p">:[</span><span class="n">aDecoder</span> <span class="nf">decodeObjectForKey</span><span class="p">:</span><span class="s">@"country"</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">setCity</span><span class="p">:[</span><span class="n">aDecoder</span> <span class="nf">decodeObjectForKey</span><span class="p">:</span><span class="s">@"city"</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span></code></pre></figure>

<p><strong>User类</strong></p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="cp">#import &lt;Foundation/Foundation.h&gt;
#import "Address.h"
</span><span class="k">@interface</span> <span class="nc">User</span> <span class="p">:</span> <span class="nc">NSObject</span><span class="o">&lt;</span><span class="n">NSCoding</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_name</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_password</span><span class="p">;</span>

    <span class="n">Address</span> <span class="o">*</span><span class="n">_address</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">password</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">retain</span><span class="p">)</span> <span class="n">Address</span> <span class="o">*</span><span class="n">address</span><span class="p">;</span>

<span class="k">@end</span>
<span class="c1">/////////////////////////////////////////////////////////
</span><span class="cp">#import "User.h"
</span>
<span class="k">@implementation</span> <span class="nc">User</span>
<span class="k">@synthesize</span> <span class="n">name</span> <span class="o">=</span> <span class="n">_name</span><span class="p">;</span>
<span class="k">@synthesize</span> <span class="n">password</span> <span class="o">=</span> <span class="n">_password</span><span class="p">;</span>
<span class="k">@synthesize</span> <span class="n">address</span> <span class="o">=</span> <span class="n">_address</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">encodeWithCoder</span><span class="p">:(</span><span class="n">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">aCoder</span><span class="p">{</span>
    <span class="p">[</span><span class="n">aCoder</span> <span class="nf">encodeObject</span><span class="p">:</span><span class="n">_name</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"name"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">aCoder</span> <span class="nf">encodeObject</span><span class="p">:</span><span class="n">_password</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"password"</span><span class="p">];</span>
    <span class="p">[</span><span class="n">aCoder</span> <span class="nf">encodeObject</span><span class="p">:</span><span class="n">_address</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"address"</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithCoder</span><span class="p">:(</span><span class="n">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">aDecoder</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">setName</span><span class="p">:[</span><span class="n">aDecoder</span> <span class="nf">decodeObjectForKey</span><span class="p">:</span><span class="s">@"name"</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">setPassword</span><span class="p">:[</span><span class="n">aDecoder</span> <span class="nf">decodeObjectForKey</span><span class="p">:</span><span class="s">@"password"</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">setAddress</span><span class="p">:[</span><span class="n">aDecoder</span> <span class="nf">decodeObjectForKey</span><span class="p">:</span><span class="s">@"address"</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span></code></pre></figure>

<p><strong>使用示例</strong></p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="n">Address</span> <span class="o">*</span><span class="n">myAddress</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">Address</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">]</span> <span class="nf">autorelease</span><span class="p">];</span>
<span class="n">myAddress</span><span class="p">.</span><span class="n">country</span> <span class="o">=</span> <span class="s">@"中国"</span><span class="p">;</span>
<span class="n">myAddress</span><span class="p">.</span><span class="n">city</span> <span class="o">=</span> <span class="s">@"杭州"</span><span class="p">;</span>
 
<span class="n">User</span> <span class="o">*</span><span class="n">user</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">User</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">]</span> <span class="nf">autorelease</span><span class="p">];</span>
<span class="n">user</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">@"卢克"</span><span class="p">;</span>
<span class="n">user</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="s">@"lukejin"</span><span class="p">;</span>
<span class="n">user</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">myAddress</span><span class="p">;</span>

<span class="p">[</span><span class="n">NSKeyedArchiver</span> <span class="nf">archiveRootObject</span><span class="p">:</span><span class="n">user</span> <span class="nf">toFile</span><span class="p">:</span><span class="s">@"/Users/Luke/Desktop/user"</span><span class="p">];</span>

<span class="n">id</span> <span class="n">object</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSKeyedUnarchiver</span> <span class="nf">unarchiveObjectWithFile</span><span class="p">:</span><span class="s">@"/Users/Luke/Desktop/user"</span><span class="p">];</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@"Object Class : %@"</span><span class="p">,[</span><span class="n">object</span> <span class="nf">class</span><span class="p">]);</span></code></pre></figure>

<p>通过查看文件内容可以发现，保存的是plist的二进制数据格式。
转成XML可以看到如下内容:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/	PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
	<span class="nt">&lt;key&gt;</span>$archiver<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;string&gt;</span>NSKeyedArchiver<span class="nt">&lt;/string&gt;</span>
	<span class="nt">&lt;key&gt;</span>$objects<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;array&gt;</span>
		<span class="nt">&lt;string&gt;</span>$null<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;dict&gt;</span>
			<span class="nt">&lt;key&gt;</span>$class<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;dict&gt;</span>
				<span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
				<span class="nt">&lt;integer&gt;</span>8<span class="nt">&lt;/integer&gt;</span>
			<span class="nt">&lt;/dict&gt;</span>
			<span class="nt">&lt;key&gt;</span>address<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;dict&gt;</span>
				<span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
				<span class="nt">&lt;integer&gt;</span>4<span class="nt">&lt;/integer&gt;</span>
			<span class="nt">&lt;/dict&gt;</span>
			<span class="nt">&lt;key&gt;</span>name<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;dict&gt;</span>
				<span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
				<span class="nt">&lt;integer&gt;</span>2<span class="nt">&lt;/integer&gt;</span>
			<span class="nt">&lt;/dict&gt;</span>
			<span class="nt">&lt;key&gt;</span>password<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;dict&gt;</span>
				<span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
				<span class="nt">&lt;integer&gt;</span>3<span class="nt">&lt;/integer&gt;</span>
			<span class="nt">&lt;/dict&gt;</span>
		<span class="nt">&lt;/dict&gt;</span>
		<span class="nt">&lt;string&gt;</span>卢克<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;string&gt;</span>lukejin<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;dict&gt;</span>
			<span class="nt">&lt;key&gt;</span>$class<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;dict&gt;</span>
				<span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
				<span class="nt">&lt;integer&gt;</span>7<span class="nt">&lt;/integer&gt;</span>
			<span class="nt">&lt;/dict&gt;</span>
			<span class="nt">&lt;key&gt;</span>city<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;dict&gt;</span>
				<span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
				<span class="nt">&lt;integer&gt;</span>6<span class="nt">&lt;/integer&gt;</span>
			<span class="nt">&lt;/dict&gt;</span>
			<span class="nt">&lt;key&gt;</span>country<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;dict&gt;</span>
				<span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
				<span class="nt">&lt;integer&gt;</span>5<span class="nt">&lt;/integer&gt;</span>
			<span class="nt">&lt;/dict&gt;</span>
		<span class="nt">&lt;/dict&gt;</span>
		<span class="nt">&lt;string&gt;</span>中国<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;string&gt;</span>杭州<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;dict&gt;</span>
			<span class="nt">&lt;key&gt;</span>$classes<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;array&gt;</span>
				<span class="nt">&lt;string&gt;</span>Address<span class="nt">&lt;/string&gt;</span>
				<span class="nt">&lt;string&gt;</span>NSObject<span class="nt">&lt;/string&gt;</span>
			<span class="nt">&lt;/array&gt;</span>
			<span class="nt">&lt;key&gt;</span>$classname<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;string&gt;</span>Address<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;/dict&gt;</span>
		<span class="nt">&lt;dict&gt;</span>
			<span class="nt">&lt;key&gt;</span>$classes<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;array&gt;</span>
				<span class="nt">&lt;string&gt;</span>User<span class="nt">&lt;/string&gt;</span>
				<span class="nt">&lt;string&gt;</span>NSObject<span class="nt">&lt;/string&gt;</span>
			<span class="nt">&lt;/array&gt;</span>
			<span class="nt">&lt;key&gt;</span>$classname<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;string&gt;</span>User<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;/dict&gt;</span>
	<span class="nt">&lt;/array&gt;</span>
	<span class="nt">&lt;key&gt;</span>$top<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;dict&gt;</span>
		<span class="nt">&lt;key&gt;</span>root<span class="nt">&lt;/key&gt;</span>
		<span class="nt">&lt;dict&gt;</span>
			<span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;integer&gt;</span>1<span class="nt">&lt;/integer&gt;</span>
		<span class="nt">&lt;/dict&gt;</span>
	<span class="nt">&lt;/dict&gt;</span>
	<span class="nt">&lt;key&gt;</span>$version<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;integer&gt;</span>100000<span class="nt">&lt;/integer&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span></code></pre></figure>

<p>###2.2 序列化
在实际的项目中，我们一般是将NSDictionary或NSArray的对象保存到文件或者从文件读取成对象。
当然这种只是适用于数据量不是很大的应用场景。
NSDictionary和NSArray 都有一个写入文件的方法</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc">	
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">writeToFile</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">atomically</span><span class="p">:(</span><span class="n">BOOL</span><span class="p">)</span><span class="nv">useAuxiliaryFile</span><span class="p">;</span></code></pre></figure>

<p>NSDictionary和NSArray会直接写成plist文件。</p>

<p>####2.2.1 序列化的方式
序列化可以通过两种途径来进行</p>

<p>#####使用数据对象自带的方法
写文件</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc">	
<span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">dataDictionary</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">NSMutableDictionary</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">]</span> <span class="nf">autorelease</span><span class="p">];</span>
 <span class="p">[</span><span class="n">dataDictionary</span> <span class="nf">setValue</span><span class="p">:[</span><span class="n">NSNumber</span> <span class="nf">numberWithInt</span><span class="p">:</span><span class="mi">222</span><span class="p">]</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"intNumber"</span><span class="p">];</span>
 <span class="p">[</span><span class="n">dataDictionary</span> <span class="nf">setValue</span><span class="p">:[</span><span class="n">NSArray</span> <span class="nf">arrayWithObjects</span><span class="p">:</span><span class="s">@"1"</span><span class="p">,</span><span class="s">@"2"</span><span class="p">,</span> <span class="nb">nil</span><span class="p">]</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"testArray"</span><span class="p">];</span>
 <span class="p">[</span><span class="n">dataDictionary</span> <span class="nf">writeToFile</span><span class="p">:</span><span class="s">@"/Users/Luke/Desktop/test.plist"</span> <span class="nf">atomically</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span></code></pre></figure>

<p>写完的文件内容如下:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">	
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
	<span class="nt">&lt;key&gt;</span>intNumber<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;integer&gt;</span>222<span class="nt">&lt;/integer&gt;</span>
	<span class="nt">&lt;key&gt;</span>testArray<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;array&gt;</span>
		<span class="nt">&lt;string&gt;</span>1<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;string&gt;</span>2<span class="nt">&lt;/string&gt;</span>
	<span class="nt">&lt;/array&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span></code></pre></figure>

<p>从文件读取</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc">	   
<span class="n">NSDictionary</span> <span class="o">*</span><span class="n">dictionaryFromFile</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDictionary</span> <span class="nf">dictionaryWithContentsOfFile</span><span class="p">:</span><span class="s">@"/Users/Luke/Desktop/test.plist"</span><span class="p">];</span></code></pre></figure>

<h5 id="shi-yong-nspropertylistserializationlei-">使用NSPropertyListSerialization类</h5>
<p>通过NSPropertyListSerialization类可以将数据对象直接转成NSData或者直接写到文件或者流中去.</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc">	   
<span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">dataDictionary</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">NSMutableDictionary</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">]</span> <span class="nf">autorelease</span><span class="p">];</span>
<span class="p">[</span><span class="n">dataDictionary</span> <span class="nf">setValue</span><span class="p">:[</span><span class="n">NSNumber</span> <span class="nf">numberWithInt</span><span class="p">:</span><span class="mi">222</span><span class="p">]</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"intNumber"</span><span class="p">];</span>
<span class="p">[</span><span class="n">dataDictionary</span> <span class="nf">setValue</span><span class="p">:[</span><span class="n">NSArray</span> <span class="nf">arrayWithObjects</span><span class="p">:</span><span class="s">@"1"</span><span class="p">,</span><span class="s">@"2"</span><span class="p">,</span> <span class="nb">nil</span><span class="p">]</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"testArray"</span><span class="p">];</span>

<span class="n">NSString</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
<span class="n">NSData</span> <span class="o">*</span><span class="n">xmlData</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSPropertyListSerialization</span> <span class="nf">dataFromPropertyList</span><span class="p">:</span><span class="n">dataDictionary</span>
                                                           <span class="nf">format</span><span class="p">:</span><span class="n">NSPropertyListXMLFormat_v1_0</span>
                                                 <span class="n">errorDescription</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="n">xmlData</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"No error creating XML data."</span><span class="p">);</span>
    <span class="p">[</span><span class="n">xmlData</span> <span class="nf">writeToFile</span><span class="p">:</span><span class="s">@"/Users/Luke/Desktop/test2.plist"</span> <span class="nf">atomically</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"error:%@"</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
        <span class="p">[</span><span class="n">error</span> <span class="nf">release</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>读取</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc">	   
	<span class="n">NSDictionary</span> <span class="o">*</span><span class="n">dictionaryFromFile</span> <span class="o">=</span> <span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)[</span><span class="n">NSPropertyListSerialization</span> 
 	                                                   <span class="nf">propertyListWithData</span><span class="p">:[</span><span class="n">NSData</span> <span class="nf">dataWithContentsOfFile</span><span class="p">:</span><span class="s">@"/Users/Luke/Desktop/test2.plist"</span><span class="p">]</span> 
	                                                    <span class="nf">options</span><span class="p">:</span><span class="mi">0</span>
	                                                    <span class="n">format</span><span class="o">:</span><span class="nb">NULL</span>
	                                                    <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span></code></pre></figure>

<p>####2.2.2 User Defaults
User Defaults 顾名思义就是一个用户为系统以及程序设置的默认值。每个用户都有自己的一套数据，用户和用户之间没法共享的。</p>

<p>我们都知道每一个程序都会保存一些设置数据，比如记住上次窗口的位置和大小，记住是否弹出某些提示信息等。苹果提供了一个统一的解决方案，就是每一个app都有一个plist文件专门用以保存偏好设置数据。
plist文件名默认是程序Bundle identifier,扩展名为plist.</p>

<p>除了程序自己的设置外，系统还有一些全局的或者其它的一些设置，也属于User Defaults的范畴，User Defaults的持久化数据都保存在 <code class="highlighter-rouge">~/Library/Preferences</code> 目录中.</p>

<p>这里有一点简要的说一下，User Defaults  中存放的key value分放在多个Domain中，取的时候按一定的次序取查找，次序如下:</p>

<ul>
  <li><strong>The Argument Domain</strong>   程序启动的时候以参数的方式传入的</li>
  <li><strong>The Application Domain</strong> 通过NSUserDefaults往里面写数据的时候默认就是写到这个Domain的，通过Bundle identifier来标识</li>
  <li><strong>The Global Domain</strong> 用户的全局的设置（系统的偏好设置）会放在这个Domain下，比如用户的语言设置，滚动条的设置等，里面的设置会对所有的程序起作用。</li>
  <li><strong>The Languages Domains</strong></li>
  <li><strong>The Registration Domain</strong>  这个domain里面的key value是提供默认值的，一般会在程序启动的设置进行设置，他们都不会被持久化到文件的。当某个key对应的值在上面的那些domain中都不存在的时候，就到这里找。</li>
</ul>

<p>Mac系统还为user defaults提供了很好的命令行工具，<code class="highlighter-rouge">defaults</code> 你可以通过下面的方式查看具体使用方式</p>

<div class="highlighter-rouge"><pre class="highlight"><code>man defaults
</code></pre>
</div>

<p>可以通过<code class="highlighter-rouge">defaults domains</code>查看当前用户的所有的domain，通过 <code class="highlighter-rouge">defaults read NSGlobalDomain</code> 读取 <strong>The Global Domain</strong> 中的所有值。</p>

<p><strong>NSUserDefaults</strong> 类来读写Preferences设置，而无需考虑文件位置等细节问题。</p>

<p><strong>NSUserDefaults</strong> 用起来和 <strong>NSDictionary</strong> 很相似，多了一个Domain的概念在里面。
<strong>NSUserDefaults</strong> 一样提供了一个获取单例的方法.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>+ (NSUserDefaults *)standardUserDefaults
</code></pre>
</div>

<p>NSUserDefaults提供了一系列的接口来根据key获取对应的value，搜索的次序按照上面提及到的次序在各个Domain中进行查找。还提供了一系列的 Setting Default Values的方法，这些设置的值都是在 <strong>The Application Domain</strong> 下的.当然也提供了修改其他Domain下的值的方法，只是需要整体的设置。</p>

<p>##3.数据库
Mac上自带安装了SQLite3 ,如果你之前接触过关系型数据库，你可以通过命令行来对SQLite进行初步的认识</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">	   
<span class="gp">$ </span>sqlite3 test.db
SQLite version 3.7.5
Enter <span class="s2">".help"</span> <span class="k">for </span>instructions
Enter SQL statements terminated with a <span class="s2">";"</span>
sqlite&gt;create table <span class="k">if </span>not exists names<span class="o">(</span>id integer primary key asc, name text<span class="o">)</span>; 
<span class="gp">sqlite&gt; </span>insert into names<span class="o">(</span>name<span class="o">)</span> values<span class="o">(</span><span class="s1">'Luke'</span><span class="o">)</span>;
<span class="gp">sqlite&gt; </span><span class="k">select</span> <span class="k">*</span> from names;
1|Luke
<span class="gp">sqlite&gt; </span></code></pre></figure>

<p>那如果在代码中使用SQLite呢？</p>

<ul>
  <li>添加sqlite的动态链接库 libsqlite3.0.dylib</li>
  <li>引入头文件 #import “sqlite3.h”</li>
</ul>

<p>这样之后你便可以通过C的接口来操作数据库了</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc">	   
<span class="n">sqlite3</span> <span class="o">*</span><span class="n">database</span><span class="p">;</span><span class="c1">//sqlite3的类型其实只是一个结构体struct
</span><span class="n">NSArray</span> <span class="o">*</span><span class="n">documentsPaths</span><span class="o">=</span><span class="n">NSSearchPathForDirectoriesInDomains</span><span class="p">(</span><span class="n">NSDocumentDirectory</span> 
                                                         <span class="p">,</span> <span class="n">NSUserDomainMask</span> 
                                                         <span class="p">,</span> <span class="nb">YES</span><span class="p">);</span> 
<span class="n">NSString</span> <span class="o">*</span><span class="n">databaseFilePath</span><span class="o">=</span><span class="p">[[</span><span class="n">documentsPaths</span> <span class="nf">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="nf">stringByAppendingPathComponent</span><span class="p">:</span><span class="s">@"luke.db"</span><span class="p">];</span>

<span class="c1">//打开数据库
</span><span class="k">if</span> <span class="p">(</span><span class="n">sqlite3_open</span><span class="p">([</span><span class="n">databaseFilePath</span> <span class="nf">UTF8String</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">database</span><span class="p">)</span><span class="o">==</span><span class="n">SQLITE_OK</span><span class="p">)</span> <span class="p">{</span> 
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"open sqlite db ok."</span><span class="p">);</span> 
    <span class="kt">char</span> <span class="o">*</span><span class="n">errorMsg</span><span class="p">;</span> 
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">createSql</span><span class="o">=</span><span class="s">"create table if not exists names (id integer primary key asc,name text)"</span><span class="p">;</span>
    <span class="c1">//创建表
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">sqlite3_exec</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">createSql</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errorMsg</span><span class="p">)</span><span class="o">==</span><span class="n">SQLITE_OK</span><span class="p">)</span> <span class="p">{</span> 
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"create ok."</span><span class="p">);</span> 
    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"error: %s"</span><span class="p">,</span><span class="n">errorMsg</span><span class="p">);</span> 
        <span class="n">sqlite3_free</span><span class="p">(</span><span class="n">errorMsg</span><span class="p">);</span>
    <span class="p">}</span>
    
    
    <span class="c1">//插入数据
</span>    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">insertSql</span><span class="o">=</span><span class="s">"insert into names (name) values(</span><span class="se">\"</span><span class="s">Luke</span><span class="se">\"</span><span class="s">)"</span><span class="p">;</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">sqlite3_exec</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">insertSql</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errorMsg</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQLITE_OK</span><span class="p">)</span> <span class="p">{</span> 
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"insert ok."</span><span class="p">);</span> 
    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"error: %s"</span><span class="p">,</span><span class="n">errorMsg</span><span class="p">);</span> 
        <span class="n">sqlite3_free</span><span class="p">(</span><span class="n">errorMsg</span><span class="p">);</span> 
    <span class="p">}</span>
    
    
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">selectSql</span><span class="o">=</span><span class="s">"select id,name from names"</span><span class="p">;</span> 
    <span class="n">sqlite3_stmt</span> <span class="o">*</span><span class="n">statement</span><span class="p">;</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">sqlite3_prepare_v2</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">selectSql</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">statement</span><span class="p">,</span> <span class="nb">nil</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQLITE_OK</span><span class="p">)</span> <span class="p">{</span> 
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"select ok."</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">sqlite3_step</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span><span class="o">==</span><span class="n">SQLITE_ROW</span><span class="p">)</span> <span class="p">{</span> 
        <span class="kt">int</span> <span class="n">_id</span><span class="o">=</span><span class="n">sqlite3_column_int</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> 
        <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">sqlite3_column_text</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> 
        <span class="n">NSString</span> <span class="o">*</span><span class="n">nameString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithCString</span><span class="p">:</span><span class="n">name</span> <span class="nf">encoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span><span class="p">];</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"row&gt;&gt;id %i, name %@"</span><span class="p">,</span><span class="n">_id</span><span class="p">,</span><span class="n">nameString</span><span class="p">);</span> 
    <span class="p">}</span>
    
    <span class="n">sqlite3_finalize</span><span class="p">(</span><span class="n">statement</span><span class="p">);</span>
    
<span class="p">}</span>

<span class="n">sqlite3_close</span><span class="p">(</span><span class="n">database</span><span class="p">);</span></code></pre></figure>

<p>你会发现这完全是C语言编程，和Objective-C的代码混在一起格格不入，也很不方便，所以便有人开发了开源的sqlite c接口的wrapper</p>

<ul>
  <li>FMDB <a href="https://github.com/ccgus/fmdb">https://github.com/ccgus/fmdb</a></li>
  <li>EGODatabase  <a href="https://github.com/ccgus/fmdb">https://github.com/enormego/egodatabase</a> (部分代码来自FMDB，thread safe)</li>
</ul>

<p>具体的使用方法，各自的文档都写的比较清楚。
FMDB不支持多线程同时使用同一个数据库连接进行操作，否则会有线程安全问题，有可能导致数据库文件损坏。EGODatabase则引入了多线程的支持，部分代码借鉴了FMDB，两者在使用上非常的相似。另EGODatabase提供了异步数据库操作的支持，将数据库操作封装成数据库请求（其继承于NSOperation），数据库请求创建好了，丢到一个OperationQueue中被异步的进行执行，当请求数据完成之后 ，相应的delegate方法会被调用，然后你可以在主线程更新显示了.</p>

</section>
<section class="meta">
<span class="author">
  <a href="http://geeklu.com">dfas</a>
</span>
<span class="time">
  /
  <time datetime="2012-01-19">2012-01-19</time>
</span>
<br />
<span class="license">
  Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
</span>

<span class="categories">
  in categories
  
  <a href="/categories/#Programming" title="Programming">Programming</a>&nbsp;
  
</span>


<span class="tags">
  tagged with 
  
  <a href="/tags/#iOS" title="iOS">iOS</a>&nbsp;
  
  <a href="/tags/#Objc" title="Objc">Objc</a>&nbsp;
  
</span>

</section>
<section class="comment">
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/2012/01/ios-persistence/" data-title="iOS持久化" data-url="http://localhost:4000/2012/01/ios-persistence/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"geeklu"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://localhost:4000/2012/01/block/';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://localhost:4000/2012/01/macios-socket/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>


        </article>
      </div>

    <footer>
        <p><small>Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> | Copyright 2008 - 2017 by <a href="https://tyctac.github.io/">dfas</a> | <span class="label label-info">2017-01-02 22:48:40 CST</span></small></p>
    </footer>

    </div>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-12936429-2']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
